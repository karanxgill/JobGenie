<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Study Materials - JobGenie Admin</title>
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dark" id="main-body">
    <div class="admin-container">
        <!-- Admin Navbar will be inserted here -->
        <div id="admin-navbar-placeholder"></div>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Top Bar -->
            <header class="admin-header">
                <div class="header-search">
                    <input type="text" placeholder="Search study materials...">
                    <button><i class="fas fa-search"></i></button>
                </div>

                <div class="header-user">
                    <span class="user-name">Admin User</span>

                </div>
            </header>

            <!-- Study Materials Content -->
            <div class="content-wrapper">
                <div class="content-header">
                    <h1>Manage Study Materials</h1>
                    <div class="header-actions">
                        <button class="add-new-btn" id="add-study-material-btn">
                            <i class="fas fa-plus"></i> Add New Study Material
                        </button>
                        <button class="reset-btn" id="reset-data-btn" style="margin-left: 10px; background-color: #f44336;">
                            
                        </button>
                        <button class="reset-btn" id="clear-data-btn" style="margin-left: 10px; background-color: #d32f2f;">
                            
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="content-filters">
                    <div class="filter-group">
                        <label for="study-material-type-filter">Type:</label>
                        <select id="study-material-type-filter">
                            <option value="">All Types</option>
                            <option value="notes">Notes</option>
                            <option value="ebooks">E-Books</option>
                            <option value="videos">Videos</option>
                            <option value="mock-tests">Mock Tests</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="study-material-category-filter">Category:</label>
                        <select id="study-material-category-filter">
                            <option value="">All Categories</option>
                            <option value="ssc">SSC</option>
                            <option value="upsc">UPSC</option>
                            <option value="banking">Banking</option>
                            <option value="railway">Railway</option>
                            <option value="teaching">Teaching</option>
                            <option value="defence">Defence</option>
                            <option value="state">State Exams</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="study-material-featured-filter">Featured:</label>
                        <select id="study-material-featured-filter">
                            <option value="">All</option>
                            <option value="true">Featured</option>
                            <option value="false">Not Featured</option>
                        </select>
                    </div>

                    <button class="filter-btn" id="apply-filters-btn">Apply Filters</button>
                    <button class="filter-btn clear-btn" id="clear-filters-btn">Clear Filters</button>
                </div>

                <!-- Study Materials Table -->
                <div class="content-table">
                    <table id="study-materials-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Category</th>
                                <th>Link</th>
                                <th>Featured</th>
                                <th>Added Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="study-materials-table-body">
                            <!-- Study Materials will be loaded from JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="content-pagination" id="study-materials-pagination">
                    <!-- Pagination will be generated by JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Study Material Modal -->
    <div class="modal" id="study-material-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Study Material</h2>
                <span class="close-modal">&times;</span>
            </div>

            <div class="modal-body">
                <form id="study-material-form">
                    <input type="hidden" id="study-material-id">

                    <div class="form-group">
                        <label for="study-material-title">Title*</label>
                        <input type="text" id="study-material-title" required>
                    </div>

                    <div class="form-group">
                        <label for="study-material-type">Type*</label>
                        <select id="study-material-type" required>
                            <option value="">Select Type</option>
                            <option value="notes">Notes</option>
                            <option value="ebooks">E-Books</option>
                            <option value="videos">Videos</option>
                            <option value="mock-tests">Mock Tests</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="study-material-category">Category*</label>
                        <select id="study-material-category" required>
                            <option value="">Select Category</option>
                            <option value="ssc">SSC</option>
                            <option value="upsc">UPSC</option>
                            <option value="banking">Banking</option>
                            <option value="railway">Railway</option>
                            <option value="teaching">Teaching</option>
                            <option value="defence">Defence</option>
                            <option value="state">State Exams</option>
                        </select>
                    </div>

                    <div class="form-group" id="link-field-container">
                        <label for="study-material-link">Link*</label>
                        <input type="url" id="study-material-link" required>
                        <small class="form-help-text" id="link-help-text">Enter the URL for the study material</small>
                    </div>

                    <div class="form-group" id="thumbnail-field-container" style="display: none;">
                        <label for="study-material-thumbnail">Thumbnail URL (Auto-generated)</label>
                        <input type="url" id="study-material-thumbnail" readonly>
                        <small class="form-help-text">Thumbnail is automatically generated from the YouTube video URL</small>
                        <button type="button" id="test-thumbnail-btn" class="btn" style="margin-top: 10px;">Test Thumbnail</button>
                        <div id="thumbnail-test-result" style="margin-top: 10px;"></div>
                    </div>

                    <div class="form-group">
                        <label for="study-material-description">Description</label>
                        <textarea id="study-material-description" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="study-material-featured">Featured</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="study-material-featured">
                            <label for="study-material-featured">Mark as featured</label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="cancel-btn" id="cancel-study-material-btn" style="background-color: #ff9900; color: white;">Cancel</button>
                        <button type="submit" class="save-btn" id="save-study-material-btn">Save Study Material</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="delete-modal">
        <div class="modal-content delete-modal-content">
            <div class="modal-header">
                <h2>Confirm Delete</h2>
                <span class="close-modal">&times;</span>
            </div>

            <div class="modal-body">
                <p>Are you sure you want to delete this study material? This action cannot be undone.</p>

                <!-- Loading indicator (hidden by default) -->
                <div id="delete-loading" style="display: none; text-align: center; margin: 10px 0;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                    <p>Deleting study material...</p>
                </div>

                <div class="form-actions">
                    <button type="button" class="cancel-btn" id="cancel-delete-btn" style="background-color: #ff9900; color: white;">Cancel</button>
                    <button type="button" class="delete-btn" id="confirm-delete-btn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load other scripts -->
    <script src="../js/main.js"></script>
    <script src="../js/api-service.js"></script>
    <script src="../js/mobile-menu.js"></script>
    <script src="../js/admin-includes.js"></script>
    <script src="../js/admin-handler.js"></script>
    <!-- Removed admin-button-fix.js to prevent duplicate event listeners -->
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the admin study materials page
            initAdminStudyMaterialsPage();

            // Add event listener for test thumbnail button
            const testThumbnailBtn = document.getElementById('test-thumbnail-btn');
            if (testThumbnailBtn) {
                testThumbnailBtn.addEventListener('click', function() {
                    const linkField = document.getElementById('study-material-link');
                    const resultDiv = document.getElementById('thumbnail-test-result');

                    if (linkField && resultDiv) {
                        const url = linkField.value.trim();
                        if (!url) {
                            resultDiv.innerHTML = '<div class="alert alert-error">Please enter a YouTube URL first</div>';
                            return;
                        }

                        resultDiv.innerHTML = '<div class="alert alert-info">Testing thumbnail extraction...</div>';

                        // Extract video ID
                        const videoId = extractYouTubeVideoId(url);

                        if (videoId) {
                            // Create thumbnail URL
                            const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;

                            // Create a preview of the thumbnail
                            setTimeout(function() {
                                resultDiv.innerHTML = `
                                    <div class="alert alert-success">
                                        <p>Video ID: ${videoId}</p>
                                        <p>Thumbnail URL: ${thumbnailUrl}</p>
                                    </div>
                                    <div style="margin-top: 10px;">
                                        <p><strong>Thumbnail Preview:</strong></p>
                                        <img src="${thumbnailUrl}" alt="Thumbnail Preview"
                                             style="max-width: 100%; border: 1px solid #ddd; margin-top: 5px;"
                                             onerror="this.onerror=null; this.src='https://i.ytimg.com/vi/${videoId}/hqdefault.jpg'; console.log('Falling back to hqdefault thumbnail');">
                                    </div>
                                `;
                            }, 1000);
                        } else {
                            resultDiv.innerHTML = '<div class="alert alert-error">Failed to extract video ID from the URL</div>';
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
